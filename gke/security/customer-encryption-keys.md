# Використання наданих клієнтом ключів шифрування

## Налаштувати необхідні ресурси

1) Створіть обліковий запис служби IAM `cseklab` з роллю `Cloud Storage > Storage Admin`
2) Створіть віртуальну машину `e2-micro` з назвою `cseklab-vm` і використанням облікового запису служби IAM `cseklab`
3) Створіть Cloud Storage bucket:

```sh
export BUCKET_NAME=[Google_Cloud_PROJECT_ID]-csek
```

```sh
gsutil mb -l us gs://$BUCKET_NAME
```

## Налаштувати надані замовником ключі шифрування

1) У терміналі cseklab-vm SSH виконайте таку команду, щоб створити ключ:

```sh
openssl rand 32 > mykey.txt
openssl base64 -in mykey.txt
```

2) Скопіюйте значення згенерованого ключа. Це знадобиться для наступного кроку.

## Змініть файл .boto

1) Виконайте таку команду в терміналі SSH, щоб перевірити існування файлу .boto :

```sh
ls -la
```

2) Якщо ви не бачите файл .boto, виконайте такі команди, щоб згенерувати та вивести його в список:

```sh
gsutil config -n
ls -al
```

3) У файлі .boto знайдіть рядок із " #encryption_key= ". Розкоментуйте рядок encryption_key, видаливши символ #,
і вставте ключ, який ви згенерували раніше. Ключ додано.

## Ротація ключів CSEK

1) У терміналі SSH виконайте таку команду, щоб створити новий ключ:

```sh
openssl rand 32 > mykey.txt
openssl base64 -in mykey.txt
```

2) Скопіюйте значення згенерованого ключа з результату команди. Ключ має бути у формі tmxElCaabWvJqR7uXEWQF39DhWTcDvChzuCmpHe6sb0=.
3) У файлі .boto знайдіть поточний рядок encryption_key і закоментуйте його, додавши символ # на початку рядка.
4) Додайте новий рядок із encryption_key= і вставте нове значення ключа.
5) Розкоментуйте рядок decryption_key1= , видаливши символ #.
6) Скопіюйте значення вихідного encryption_key із рядка, який було закоментовано, і вставте його як значення рядка decryption_key1 .